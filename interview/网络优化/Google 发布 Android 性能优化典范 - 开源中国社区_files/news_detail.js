define("www_news_detail",["throttle","viewport","msg","tooltips"],function(t,e,i,n){var o=function(){this.__name="News",this.replyinline_dup=!1};return o.prototype={constructor:o,ajax_post:function(t,e,i){$.ajax({type:"POST",url:t,data:e,success:i,error:function(t){alert("提交数据失败，代码:"+t.status+"，请稍候再试")}})},top:function(e){var i,n=$(".sc-tool-backtop");n.bind("click",function(){$("html, body").stop().animate({scrollTop:0},"500","swing")}),i=function(){var t=e.scrollTop();return t>200?void n.removeClass("hide").addClass("show"):void n.removeClass("show").addClass("hide")},i(),t.requestAnimationFrame(i,300)},showBox:function(){$(".mask").removeClass("hide")},closeBox:function(){$(".mask").addClass("hide")},updateCommentCount:function(t){var e=$(".blog-heading .text-gary ul li.comment span"),i=e.html(),n=parseInt(i)+t;e.html(n),$("#blog-comments-list .reply_count").html(n)},dynamic_emoji_render:function(){$("[data-emoji-render='true']").emoticon().css("opacity",1)},form_comment_pub:function(){var t,i=this,n=$("#comp_totle_reply_count"),o=$(".latest-comment .insert-comment-flag"),a=$("#form_comment"),s=a.find("textarea"),r=a.find("#cmt_tip"),m=$("#commentSubmitBtn");m.removeAttr("disabled").text("发表评论"),t=!1,t||(a.ajaxForm({dataType:"json",beforeSubmit:function(e,i,n){t=!0,m.text("提交中..")},success:function(a){var c,l,d;a.error?r.text(a.msg):(c=a.id,l=a.news,d=a.user,$.ajax({type:"GET",url:"/action/ajax/get_pc_news_comment",data:{commentid:c,newsid:l,user:d},success:function(t){var a,m=n.text(),u="#cmt_"+l+"_"+d+"_"+c;m?n.text(parseInt(m)+1):n.text(0),o.after(t),a=$(u),a.get(0)&&!e.isElementInViewport(a.get(0))&&$("html:not(:animated), body:not(:animated)").animate({scrollTop:a.offset().top-$(window).height()/2},1e3),i.dynamic_emoji_render(),s.val(""),r.text("")},error:function(t){alert("提交数据失败，代码:"+t.status+"，请稍候再试")}})),t=!1,m.text("发表评论")}}),a.on("keydown",function(t){(t.metaKey||t.ctrlKey)&&13===t.keyCode&&a.submit()}))},ReplyInline:function(t,e,i,n){var o,a,s,r,m,c=this,l=$(t),d=$("#inline_reply_editor").html(),u=$(l.data("insert"));return u.children().length>0?u.empty():(u.append(d),this.inlineTextbox=u.find("#ccom_content"),o=u.find("#btn_close_inline_reply"),o.bind("click",function(){o.unbind("click"),u.empty()}),this.inlineTextbox.focus(),a=u.find("#form_inline_comment"),s=$("#comp_totle_reply_count"),r=a.find("textarea"),m=u.find("#inline_reply_id"),cmtTip=a.find("#ficmp_msg"),commentItem=$("#cmt_"+e+"_"+i+"_"+n),m.val(i+"_"+n),a.ajaxForm({dataType:"json",success:function(t){var e,i,n;t.error?cmtTip.text(t.msg):(e=t.id,i=t.news,n=t.user,$.ajax({type:"GET",url:"/action/ajax/get_pc_news_comment",data:{commentid:e,newsid:i,user:n},success:function(t){var e=s.text();e?s.text(parseInt(e)+1):s.text(0),commentItem.after(t),c.dynamic_emoji_render(),r.val(""),cmtTip.text(""),m.val(""),u.empty()},error:function(t){alert("提交数据失败，代码:"+t.status+"，请稍候再试")}}))}}),void a.on("keydown",function(t){(t.metaKey||t.ctrlKey)&&13===t.keyCode&&a.submit()}))},reply_tweet_add_emoji:function(){var t=$(document);t.delegate(".emoji-block","click",function(t){var e=$(t.target),i=e.parents(".comp-comment-form").find("textarea"),n=i.val();n+=":"+e.attr("title")+":",i.val(n)}),t.delegate(".svg-ic-comment-smile-dims","click",function(t){t.stopPropagation();var e=$(t.target),i=e.attr("data-show-emoji");i&&"false"!=i?e.attr("data-show-emoji","false").parents(".comment-emoji").find('[data-emoji="wrapper"]').hide():e.attr("data-show-emoji","true").parents(".comment-emoji").find('[data-emoji="wrapper"]').show()}),$("body").on("click",function(t){var e=t.target;$(e).parents('[data-emoji="wrapper"]').length<=0&&($("body").find('[data-emoji="wrapper"]').hide(),$("[data-show-emoji]").attr("data-show-emoji","false"))})},emoji_init:function(){function t(){var t=$('[data-emoji="wrapper"]'),i=["People","Nature","Objects","Places","Symbols"];i.forEach(function(t){$('[data-emoji-item="'+t+'"]').append(e[t])}),$("[data-emoji-item] [data-group-title]").hide(),$(".emoji-block").each(function(t){var e=$(t);e.attr("title")||e.hide()}),t.find('[data-emoji="nav"] [data-emoji-nav="People"]').addClass("active"),t.find('[data-emoji="panel"] [data-emoji-item="People"]').addClass("active")}var e={People:githubEmojiPeople,Nature:githubEmojiNature,Objects:githubEmojiObjects,Places:githubEmojiPlaces,Symbols:githubEmojiSymbols};t(e)},insert_projects:function(){if(!this.textbox){var t=$("#wmd-input");this.textbox=t.textbox({maxLength:1e3,onInput:function(){jQuery.trim(t.val())}})}this.textbox.insertText("#此处输入软件名#")},insert_projects_c:function(){var t,e;this.inlineTextbox&&(t=this.inlineTextbox,e=t.textbox({maxLength:1e3,onInput:function(){jQuery.trim(t.val())}}),e.insertText("#此处输入软件名#"))},emoji_bind_event:function(){$("body").delegate("[data-emoji-nav]","click",function(t){t.stopPropagation();var e=$(t.target),i=e.attr("data-emoji-nav"),n=e.parents('[data-emoji="wrapper"]');e.addClass("active").siblings("li").removeClass("active"),n.find('[data-emoji-item="'+i+'"]').addClass("active").siblings("[data-emoji-item]").removeClass("active")})},report:function(t,e){this.vReport||(this.vReport=new Vue({el:"#v-report",methods:{report:function(t){"object"==typeof t&&this.$broadcast("onReport",t)},removeReport:function(){this.$broadcast("closeWindow")}}})),this.vReport.report({obj_id:this.news_id,user_code:page.user_code,url:e,obj_type:this.news_object_type})},likeAndUnLike:function(t,e,i,n){var o,a=$(t),s=a.find(".js-ic-comment"),r=s.next(),m=s.hasClass("svg-ic-comment-like-dims");return m?void alert("您已点赞"):(o=0,o=r.html()?parseInt(r.html()):0,void $.ajax({url:"/action/news/voteNewsComment",type:"POST",dataType:"json",data:{vote:!m,newsCommentId:n,user:i},success:function(t,e){t.error?alert(t.msg):s.hasClass("svg-ic-comment-like-dims")?(s.html('<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#ic-comment-unlike"></use>'),s.removeClass("svg-ic-comment-like-dims").addClass("svg-ic-comment-unlike-dims"),--o,r.html(o)):(s.html('<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#ic-comment-like"></use>'),s.removeClass("svg-ic-comment-unlike-dims").addClass("svg-ic-comment-like-dims"),++o,r.html(o))}}))},loadComments:function(e,i){function n(){var t,n,m;s&&(t=i.height(),n=e.scrollTop()+e.height()>t-500,n&&(s=!1,m="/action/ajax/get_more_news_comment_list?newsid="+o.news_id+"&p="+a,o.ajax_post(m,"",function(t){return r.append(t),o.dynamic_emoji_render(),action.loadImg(),t.indexOf("no_more_data_flag")>0?void(s=!1):(++a,void(s=!0))})))}var o,a,s,r=$(".latest-comment");r.find(".no_more_data_flag").length>0||(o=this,a=2,s=!0,s&&n(),t.requestAnimationFrame(n,300))},favor_submit_form:function(){function t(t,i){var n=$(i).parents(".favor-form"),o=n.find("input[name='id']").val(),a=n.find("input[name='type']").val(),s=n.find("input[name='user']").val(),r=n.find("input[name='tags']").val();t.stopPropagation(),$.ajax({url:page.favorite_add,type:"POST",data:{id:o,type:a,user:s,tags:r},dataType:"",before:function(t,e,i){return!0},success:function(t,i){"success"==i&&e.updateFavorCountAndToggleStatus(t)},error:function(){alert("提交数据失败，代码:"+html.status+"，请稍候再试")}})}var e=this;$("form.favor_blog").submit(function(t){t.preventDefault()}),$(".favor-form .btn-favor").bind("click",function(e){var i=$(this);t(e,i)}),$(".favor-form").on("keyup","input",function(e){if(13===e.keyCode){var i=$(this);t(e,i)}})},cancle_vote:function(){var t=this;$("body").on("click",".cancelVote",function(e){var i=$(this).data("newsid"),n=$(this).data("newstype"),o=$(this).data("userid"),a=$(this).data("thispage");$.ajax({url:"/action/favorite/cancel",type:"POST",data:{id:i,type:n,user:o,this_page:a},success:function(e,i){"success"==i&&t.updateFavorCountAndToggleStatus(e)}})})},updateFavorCountAndToggleStatus:function(t){var e,i,o,a;isNaN(t)?($("#error_tip").html(t).css("display","inline-block"),n.tipstimeout()):(e=$(".btn-favor-blog"),i=$(".svg-news_big_star-dims"),o=$(".svg-news_big_star_on-dims"),e.toggleClass("hover"),e.toggleClass("active"),i.toggleClass("hide"),o.toggleClass("hide"),e.find("a").toggleClass("cancelVote"),a=e.find("span.operate_title"),a&&a.html().trim().includes("已收藏")?a.html("收藏"):a.html("已收藏"))},add_favor_tag:function(){var t=this;$(".favor-form").on("click","a.tag",function(e){var i=$(this).data("tagname"),n=$(this).parents(".favor-form").find("input[name='tags']");t.setTag(i,n)})},checkFavor:function(){var t=$(".btn-favor-blog");t.on("click",function(){var t="";"false"==page.is_login?(t='用户尚未登录，点击<a href="'+page.goto_this_page+'" target="_blank">这里</a>登录',$("#error_tip").html(t).css("display","inline-block"),n.tipstimeout(!0)):"true"==page.is_owner&&(t="不能收藏自己的博客",$("#error_tip").html(t).css("display","inline-block"),n.tipstimeout())})},setTag:function(t,e){var i=e.val(),n=i.replace(/，/gi,",").split(","),o=!1;return i=$.map(n,function(e,i){return $.trim(t)==$.trim(e)?void(o=!0):e}).join(","),o?void e.val(i):void(""!=i?e.val(i+","+t):e.val(t))},deleteComment:function(t,e,i,n){confirm("你确定要删除此评论吗？")&&$.ajax({url:"/action/news/delete_comments",type:"POST",data:{cmt:n+"#"+i+"#"+e},success:function(e,i){var n,o;"success"===i&&(n=$("#comp_totle_reply_count"),o=n.text(),o?n.text(parseInt(o)-1):n.text(0),$(t).remove())}})},register:function(){var t,e=$(window),n=$(document);this.top(e),t=!!this.is_news_commentable,t&&(this.form_comment_pub(),this.dynamic_emoji_render(),this.reply_tweet_add_emoji(),this.emoji_init(),this.emoji_bind_event(),this.loadComments(e,n)),this.g_user_login&&i.polling(this.polling_msg_tips_url),this.favor_submit_form(),this.cancle_vote(),this.add_favor_tag(),this.checkFavor()}},o});